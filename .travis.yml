language: ruby

rvm: 2.3.1

cache:
  bundler: true
  directories:
  - ${HOME}/perl5

addons:
  postgresql: 9.3

env:
  global:
  - DATABASE_URL='postgres://job_board_test'
  - COVERAGE='1'
  matrix:
  - INTEGRATION_SPECS='1'
  - INTEGRATION_SPECS='0'

before_install:
- mkdir -p ~/bin
- if ! cpanm --version ; then
    curl -L 'https://cpanmin.us/' -o ~/bin/cpanm ;
    chmod +x ~/bin/cpanm ;
    cpanm --local-lib=~/perl5 'local::lib' ;
  fi
- eval "$(perl -I ~/perl5/lib/perl5/ '-Mlocal::lib')"
- if ! sqitch --version ; then
    cpanm --quiet --notest 'App::Sqitch' ;
  fi
- cpanm --quiet --notest 'DBD::Pg'

before_script:
- createdb job_board_test
- pushd db && sqitch deploy && sqitch verify ; popd
